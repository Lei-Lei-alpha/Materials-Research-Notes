<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>ML - handle outliers · Lei&#39;s Notes</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="My private lab notes on materials science including several projects on perovskite structure materials and computational research."><meta name="generator" content="Jekyll (using style of GitBook)"><meta name="author" content="Lei Lei"><link rel="stylesheet" href="/Materials-Research-Notes/gitbook/style.css">
<link rel="stylesheet" href="/Materials-Research-Notes/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/Materials-Research-Notes/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/Materials-Research-Notes/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/Materials-Research-Notes/gitbook/rouge/colorful.css">

<link rel="stylesheet" href="/Materials-Research-Notes/gitbook/custom.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/Materials-Research-Notes/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/Materials-Research-Notes/gitbook/images/favicon.ico" type="image/x-icon">

<script>
    MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        svg: {
            fontCache: 'global'
        }
    };
</script>

            <link rel="prev" href="/Materials-Research-Notes/Chap2-ML/GBR/" />
        

        
            <link rel="next" href="/Materials-Research-Notes/Chap2-ML/Pytorch_tricks/" />
        
    </head>
    <body>
        <div class="book"><div class="book-summary">
    <div id="book-search-input" role="search">
        <input type="text" placeholder="Type to search" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes">
            
                <a href="/Materials-Research-Notes/" style="font-size: 165%; font-weight: bold;">
                    Lei&#39;s Notes
                </a>
            </li>

            <li class="divider"></li>

            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">Coding</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/python-sequences/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/python-sequences/">
                                Python - sequences
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/numpy-tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/numpy-tricks/">
                                Numpy - practical tricks and code snipets
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/Vim_cheatsheet/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/Vim_cheatsheet/">
                                Vim Cheatsheet
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/Python-tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/Python-tricks/">
                                Python practical tricks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/Python-data%20model/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/Python-data%20model/">
                                Python - data structures
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap1-Coding/Python-Code%20snipet/">
                        
                            <a href="/Materials-Research-Notes/Chap1-Coding/Python-Code%20snipet/">
                                Python - useful snippets for materials science
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">ML</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap2-ML/SHAP/">
                        
                            <a href="/Materials-Research-Notes/Chap2-ML/SHAP/">
                                SHAP
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap2-ML/Pytorch_tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap2-ML/Pytorch_tricks/">
                                Pytorch tricks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/Materials-Research-Notes/Chap2-ML/Out_liers/">
                        
                            <a href="/Materials-Research-Notes/Chap2-ML/Out_liers/">
                                ML - handle outliers
                            </a>
                            
                                
                                    <ul><li><a href="#outlier-detection-and-removal">Outlier Detection and Removal</a></li><li><a href="#dataset-and-performance-baseline">Dataset and Performance Baseline</a><ul><li><a href="#house-price-regression-dataset">House Price Regression Dataset</a></li><li><a href="#baseline-model-performance">Baseline Model Performance</a></li></ul></li><li><a href="#automatic-outlier-detection">Automatic Outlier Detection</a><ul><li><a href="#isolation-forest">Isolation Forest</a></li><li><a href="#minimum-covariance-determinant">Minimum Covariance Determinant</a></li><li><a href="#local-outlier-factor">Local Outlier Factor</a></li><li><a href="#one-class-svm">One-Class SVM</a></li></ul></li><li><a href="#further-reading">Further Reading</a><ul><li><a href="#related-tutorials">Related Tutorials</a></li><li><a href="#papers">Papers</a></li><li><a href="#apis">APIs</a></li></ul></li><li><a href="#summary">Summary</a></li><li><a href="#get-a-handle-on-modern-data-preparation">Get a Handle on Modern Data Preparation!</a></li></ul>

                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap2-ML/GBR/">
                        
                            <a href="/Materials-Research-Notes/Chap2-ML/GBR/">
                                ML - Gradient Boosting Algorithm
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">MatNotes</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap3-MatNotes/2023-05-12-Comp_Mat_Concep/">
                        
                            <a href="/Materials-Research-Notes/Chap3-MatNotes/2023-05-12-Comp_Mat_Concep/">
                                Concepts and methods in computational materials science
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">HSTORE</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap4-HSTORE/2023-05-12-interstitial-hydrides/">
                        
                            <a href="/Materials-Research-Notes/Chap4-HSTORE/2023-05-12-interstitial-hydrides/">
                                Solid hydrogen storage materials: interstitial hydrides
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap4-HSTORE/2022-03-29-AIMD-simulation-with-efield/">
                        
                            <a href="/Materials-Research-Notes/Chap4-HSTORE/2022-03-29-AIMD-simulation-with-efield/">
                                AIMD simulation for MAPbI3 under electric filed
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">CompMat</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap5-CompMat/VASP-tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap5-CompMat/VASP-tricks/">
                                VASP errors and practical tricks
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">Visualisation</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap6-Visualisation/pandas_tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap6-Visualisation/pandas_tricks/">
                                Pandas tricks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap6-Visualisation/matplotlib_tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap6-Visualisation/matplotlib_tricks/">
                                Matplotlib tricks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap6-Visualisation/example_codes/">
                        
                            <a href="/Materials-Research-Notes/Chap6-Visualisation/example_codes/">
                                Matplotlib quick examples
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap6-Visualisation/Jupyter/jupyter_tricks/">
                        
                            <a href="/Materials-Research-Notes/Chap6-Visualisation/Jupyter/jupyter_tricks/">
                                Jupyter Notebook Tricks
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">sys_ssh</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/Chap7-sys_ssh/work_on_ssh_session/">
                        
                            <a href="/Materials-Research-Notes/Chap7-sys_ssh/work_on_ssh_session/">
                                Bash, Git &amp; SSH tricks
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
                <p style="font-size: 120%; font-weight: 600; text-indent:10px;">Info</p>
                <hr>
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/ChapX-Info/quick-start/">
                        
                            <a href="/Materials-Research-Notes/ChapX-Info/quick-start/">
                                Quick Start
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/Materials-Research-Notes/ChapX-Info/about/">
                        
                            <a href="/Materials-Research-Notes/ChapX-Info/about/">
                                About
                            </a>
                            
                                
                            
                        </li>
                    
                    <li class="divider"></li>
                
            
                
            
        </ul>
    </nav>
</div><div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href="." >ML - handle outliers</a>
                        
                    </h1>
                </div>

                <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">

                    
                        <h1 id="/Chap2-ML/Out_liers" style="border-style: solid solid solid solid; border-width: 0px 0px 2px 0px; border-color: black black #F1F0F0 black;">ML - handle outliers</h1>
                    

                    
                    
                    
                    

<blockquote>
  <p>Source: <a href="https://machinelearningmastery.com/model-based-outlier-detection-and-removal-in-python/">machinelearningmastery.com</a></p>
</blockquote>

<p>The presence of outliers in a classification or regression dataset can result in a poor fit and lower predictive modeling performance.</p>

<p>Identifying and <strong>removing outliers</strong> is challenging with simple statistical methods for most machine learning datasets given the large number of input variables. Instead, automatic outlier detection methods can be used in the modeling pipeline and compared, just like other data preparation transforms that may be applied to the dataset.</p>

<h2 id="outlier-detection-and-removal">Outlier Detection and Removal</h2>

<p>Outliers are observations in a dataset that don’t fit in some way.</p>

<p>Perhaps the most common or familiar type of outlier is the observations that are far from the rest of the observations or the center of mass of observations.</p>

<p>This is easy to understand when we have one or two variables and we can visualize the data as a histogram or scatter plot, although it becomes very challenging when we have many input variables defining a high-dimensional input feature space.</p>

<p>In this case, simple statistical methods for identifying outliers can break down, such as methods that use standard deviations or the interquartile range.</p>

<p>It can be important to identify and remove outliers from data when training machine learning algorithms for predictive modeling.</p>

<p>Outliers can skew statistical measures and data distributions, providing a misleading representation of the underlying data and relationships. Removing outliers from training data prior to modeling can result in a better fit of the data and, in turn, more skillful predictions.</p>

<p>Thankfully, there are a variety of automatic model-based methods for identifying outliers in input data. Importantly, each method approaches the definition of an outlier is slightly different ways, providing alternate approaches to preparing a training dataset that can be evaluated and compared, just like any other data preparation step in a modeling pipeline.</p>

<h2 id="dataset-and-performance-baseline">Dataset and Performance Baseline</h2>

<p>Before we dive into automatic outlier detection methods, let’s first select a standard machine learning dataset that we can use as the basis for our investigation.</p>

<p>This will provide the context for exploring the outlier identification and removal method of data preparation in the next section.</p>

<h3 id="house-price-regression-dataset">House Price Regression Dataset</h3>

<p>We will use the house price regression dataset.</p>

<p>This dataset has 13 input variables that describe the properties of the house and suburb and requires the prediction of the median value of houses in the suburb in thousands of dollars.</p>

<p>You can learn more about the dataset here:</p>

<ul>
  <li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv">House Price Dataset (housing.csv)</a></li>
  <li><a href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.names">House Price Dataset Description (housing.names)</a></li>
</ul>

<p>No need to download the dataset as we will download it automatically as part of our worked examples.</p>

<p>Open the dataset and review the raw data. The first few rows of data are listed below.</p>

<p>We can see that it is a regression predictive modeling problem with numerical input variables, each of which has different scales.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>0.00632,18.00,2.310,0,0.5380,6.5750,65.20,4.0900,1,296.0,15.30,396.90,4.98,24.00</p><p>0.02731,0.00,7.070,0,0.4690,6.4210,78.90,4.9671,2,242.0,17.80,396.90,9.14,21.60</p><p>0.02729,0.00,7.070,0,0.4690,7.1850,61.10,4.9671,2,242.0,17.80,392.83,4.03,34.70</p><p>0.03237,0.00,2.180,0,0.4580,6.9980,45.80,6.0622,3,222.0,18.70,394.63,2.94,33.40</p><p>0.06905,0.00,2.180,0,0.4580,7.1470,54.20,6.0622,3,222.0,18.70,396.90,5.33,36.20</p><p>...</p></td></tr></tbody></table>

<p>The dataset has many numerical input variables that have unknown and complex relationships. We don’t know that outliers exist in this dataset, although we may guess that some outliers may be present.</p>

<p>The example below loads the dataset and splits it into the input and output columns, splits it into train and test datasets, then summarizes the shapes of the data arrays.</p>

<table><tbody><tr><td data-settings="show"></td><td><p># load and summarize the dataset</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># summarize the shape of the dataset</p><p>print(X.shape, y.shape)</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># summarize the shape of the train and test sets</p><p>print(X_train.shape, X_test.shape, y_train.shape, y_test.shape)</p></td></tr></tbody></table>

<p>Running the example, we can see that the dataset was loaded correctly and that there are 506 rows of data with 13 input variables and a single target variable.</p>

<p>The dataset is split into train and test sets with 339 rows used for model training and 167 for model evaluation.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>(506, 13) (506,)</p><p>(339, 13) (167, 13) (339,) (167,)</p></td></tr></tbody></table>

<p>Next, let’s evaluate a model on this dataset and establish a baseline in performance.</p>

<h3 id="baseline-model-performance">Baseline Model Performance</h3>

<p>It is a regression predictive modeling problem, meaning that we will be predicting a numeric value. All input variables are also numeric.</p>

<p>In this case, we will fit a linear regression algorithm and evaluate model performance by training the model on the test dataset and making a prediction on the test data and evaluate the predictions using the mean absolute error (MAE).</p>

<p>The complete example of evaluating a linear regression model on the dataset is listed below.</p>

<table><tbody><tr><td data-settings="show"><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p></td><td><p># evaluate model on the raw dataset</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p>from sklearn.linear_model import LinearRegression</p><p>from sklearn.metrics import mean_absolute_error</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># fit the model</p><p>model = LinearRegression()</p><p>model.fit(X_train, y_train)</p><p># evaluate the model</p><p>yhat = model.predict(X_test)</p><p># evaluate predictions</p><p>mae = mean_absolute_error(y_test, yhat)</p><p>print('MAE: %.3f' % mae)</p></td></tr></tbody></table>

<p>Running the example fits and evaluates the model, then reports the MAE.</p>

<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>In this case, we can see that the model achieved a MAE of about 3.417. This provides a baseline in performance to which we can compare different outlier identification and removal procedures.</p>

<h2 id="automatic-outlier-detection">Automatic Outlier Detection</h2>

<p>The scikit-learn library provides a number of built-in automatic methods for identifying outliers in data. We will review four methods and compare their performance on the house price dataset.</p>

<p>Each method will be defined, then fit on the training dataset. The fit model will then predict which examples in the training dataset are outliers and which are not (so-called inliers). The outliers will then be removed from the training dataset, then the model will be fit on the remaining examples and evaluated on the entire test dataset.</p>

<p>It would be invalid to fit the outlier detection method on the entire training dataset as this would result in <a href="https://machinelearningmastery.com/data-leakage-machine-learning/">data leakage</a>. That is, the model would have access to data (or information about the data) in the test set not used to train the model. This may result in an optimistic estimate of model performance.</p>

<p>We could attempt to detect outliers on “<em>new data</em>” such as the test set prior to making a prediction, but then what do we do if outliers are detected?</p>

<p>One approach might be to return a “<em>None</em>” indicating that the model is unable to make a prediction on those outlier cases. This might be an interesting extension to explore that may be appropriate for your project.</p>

<h3 id="isolation-forest">Isolation Forest</h3>

<p>Isolation Forest, or iForest for short, is a tree-based anomaly detection algorithm.</p>

<p>It is based on modeling the normal data in such a way as to isolate anomalies that are both few in number and different in the feature space.</p>

<blockquote>
  <p>… our proposed method takes advantage of two anomalies’ quantitative properties: i. they are the minority consisting of fewer instances and ii. they have attribute-values that are very different from those of normal instances.</p>
</blockquote>

<p>— <a href="https://ieeexplore.ieee.org/abstract/document/4781136">Isolation Forest</a>, 2008.</p>

<p>The scikit-learn library provides an implementation of Isolation Forest in the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">IsolationForest class</a>.</p>

<p>Perhaps the most important hyperparameter in the model is the “<em>contamination</em>” argument, which is used to help estimate the number of outliers in the dataset. This is a value between 0.0 and 0.5 and by default is set to 0.1.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>...</p><p># identify outliers in the training dataset</p><p>iso = IsolationForest(contamination=0.1)</p><p>yhat = iso.fit_predict(X_train)</p></td></tr></tbody></table>

<p>Once identified, we can remove the outliers from the training dataset.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>...</p><p># select all rows that are not outliers</p><p>mask = yhat != -1</p><p>X_train, y_train = X_train[mask, :], y_train[mask]</p></td></tr></tbody></table>

<p>Tying this together, the complete example of evaluating the linear model on the housing dataset with outliers identified and removed with isolation forest is listed below.</p>

<table><tbody><tr><td data-settings="show"><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></td><td><p># evaluate model performance with outliers removed using isolation forest</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p>from sklearn.linear_model import LinearRegression</p><p>from sklearn.ensemble import IsolationForest</p><p>from sklearn.metrics import mean_absolute_error</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># summarize the shape of the training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># identify outliers in the training dataset</p><p>iso = IsolationForest(contamination=0.1)</p><p>yhat = iso.fit_predict(X_train)</p><p># select all rows that are not outliers</p><p>mask = yhat != -1</p><p>X_train, y_train = X_train[mask, :], y_train[mask]</p><p># summarize the shape of the updated training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># fit the model</p><p>model = LinearRegression()</p><p>model.fit(X_train, y_train)</p><p># evaluate the model</p><p>yhat = model.predict(X_test)</p><p># evaluate predictions</p><p>mae = mean_absolute_error(y_test, yhat)</p><p>print('MAE: %.3f' % mae)</p></td></tr></tbody></table>

<p>Running the example fits and evaluates the model, then reports the MAE.</p>

<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>In this case, we can see that that model identified and removed 34 outliers and achieved a MAE of about 3.189, an improvement over the baseline that achieved a score of about 3.417.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>(339, 13) (339,)</p><p>(305, 13) (305,)</p><p>MAE: 3.189</p></td></tr></tbody></table>

<h3 id="minimum-covariance-determinant">Minimum Covariance Determinant</h3>

<p>If the input variables have a Gaussian distribution, then simple statistical methods can be used to detect outliers.</p>

<p>For example, if the dataset has two input variables and both are Gaussian, then the feature space forms a multi-dimensional Gaussian and knowledge of this distribution can be used to identify values far from the distribution.</p>

<p>This approach can be generalized by defining a hypersphere (ellipsoid) that covers the normal data, and data that falls outside this shape is considered an outlier. An efficient implementation of this technique for multivariate data is known as the Minimum Covariance Determinant, or MCD for short.</p>

<blockquote>
  <p>The Minimum Covariance Determinant (MCD) method is a highly robust estimator of multivariate location and scatter, for which a fast algorithm is available. […] It also serves as a convenient and efficient tool for outlier detection.</p>
</blockquote>

<p>— <a href="https://arxiv.org/abs/1709.07045">Minimum Covariance Determinant and Extensions</a>, 2017.</p>

<p>The scikit-learn library provides access to this method via the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.covariance.EllipticEnvelope.html">EllipticEnvelope class</a>.</p>

<p>It provides the “<em>contamination</em>” argument that defines the expected ratio of outliers to be observed in practice. In this case, we will set it to a value of 0.01, found with a little trial and error.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>...</p><p># identify outliers in the training dataset</p><p>ee = EllipticEnvelope(contamination=0.01)</p><p>yhat = ee.fit_predict(X_train)</p></td></tr></tbody></table>

<p>Once identified, the outliers can be removed from the training dataset as we did in the prior example.</p>

<p>Tying this together, the complete example of identifying and removing outliers from the housing dataset using the elliptical envelope (minimum covariant determinant) method is listed below.</p>

<table><tbody><tr><td data-settings="show"><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></td><td><p># evaluate model performance with outliers removed using elliptical envelope</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p>from sklearn.linear_model import LinearRegression</p><p>from sklearn.covariance import EllipticEnvelope</p><p>from sklearn.metrics import mean_absolute_error</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># summarize the shape of the training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># identify outliers in the training dataset</p><p>ee = EllipticEnvelope(contamination=0.01)</p><p>yhat = ee.fit_predict(X_train)</p><p># select all rows that are not outliers</p><p>mask = yhat != -1</p><p>X_train, y_train = X_train[mask, :], y_train[mask]</p><p># summarize the shape of the updated training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># fit the model</p><p>model = LinearRegression()</p><p>model.fit(X_train, y_train)</p><p># evaluate the model</p><p>yhat = model.predict(X_test)</p><p># evaluate predictions</p><p>mae = mean_absolute_error(y_test, yhat)</p><p>print('MAE: %.3f' % mae)</p></td></tr></tbody></table>

<p>Running the example fits and evaluates the model, then reports the MAE.</p>

<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>In this case, we can see that the elliptical envelope method identified and removed only 4 outliers, resulting in a drop in MAE from 3.417 with the baseline to 3.388.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>(339, 13) (339,)</p><p>(335, 13) (335,)</p><p>MAE: 3.388</p></td></tr></tbody></table>

<h3 id="local-outlier-factor">Local Outlier Factor</h3>

<p>A simple approach to identifying outliers is to locate those examples that are far from the other examples in the feature space.</p>

<p>This can work well for feature spaces with low dimensionality (few features), although it can become less reliable as the number of features is increased, referred to as the curse of dimensionality.</p>

<p>The local outlier factor, or LOF for short, is a technique that attempts to harness the idea of nearest neighbors for outlier detection. Each example is assigned a scoring of how isolated or how likely it is to be outliers based on the size of its local neighborhood. Those examples with the largest score are more likely to be outliers.</p>

<blockquote>
  <p>We introduce a local outlier (LOF) for each object in the dataset, indicating its degree of outlier-ness.</p>
</blockquote>

<p>— <a href="https://dl.acm.org/citation.cfm?id=335388">LOF: Identifying Density-based Local Outliers</a>, 2000.</p>

<p>The scikit-learn library provides an implementation of this approach in the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.LocalOutlierFactor.html">LocalOutlierFactor class</a>.</p>

<p>The model provides the “<em>contamination</em>” argument, that is the expected percentage of outliers in the dataset, be indicated and defaults to 0.1.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>...</p><p># identify outliers in the training dataset</p><p>lof = LocalOutlierFactor()</p><p>yhat = lof.fit_predict(X_train)</p></td></tr></tbody></table>

<p>Tying this together, the complete example of identifying and removing outliers from the housing dataset using the local outlier factor method is listed below.</p>

<table><tbody><tr><td data-settings="show"><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></td><td><p># evaluate model performance with outliers removed using local outlier factor</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p>from sklearn.linear_model import LinearRegression</p><p>from sklearn.neighbors import LocalOutlierFactor</p><p>from sklearn.metrics import mean_absolute_error</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># summarize the shape of the training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># identify outliers in the training dataset</p><p>lof = LocalOutlierFactor()</p><p>yhat = lof.fit_predict(X_train)</p><p># select all rows that are not outliers</p><p>mask = yhat != -1</p><p>X_train, y_train = X_train[mask, :], y_train[mask]</p><p># summarize the shape of the updated training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># fit the model</p><p>model = LinearRegression()</p><p>model.fit(X_train, y_train)</p><p># evaluate the model</p><p>yhat = model.predict(X_test)</p><p># evaluate predictions</p><p>mae = mean_absolute_error(y_test, yhat)</p><p>print('MAE: %.3f' % mae)</p></td></tr></tbody></table>

<p>Running the example fits and evaluates the model, then reports the MAE.</p>

<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>In this case, we can see that the local outlier factor method identified and removed 34 outliers, the same number as isolation forest, resulting in a drop in MAE from 3.417 with the baseline to 3.356. Better, but not as good as isolation forest, suggesting a different set of outliers were identified and removed.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>(339, 13) (339,)</p><p>(305, 13) (305,)</p><p>MAE: 3.356</p></td></tr></tbody></table>

<h3 id="one-class-svm">One-Class SVM</h3>

<p>The <a href="https://machinelearningmastery.com/support-vector-machines-for-machine-learning/">support vector machine</a>, or SVM, algorithm developed initially for binary classification can be used for one-class classification.</p>

<p>When modeling one class, the algorithm captures the density of the majority class and classifies examples on the extremes of the density function as outliers. This modification of SVM is referred to as One-Class SVM.</p>

<blockquote>
  <p>… an algorithm that computes a binary function that is supposed to capture regions in input space where the probability density lives (its support), that is, a function such that most of the data will live in the region where the function is nonzero.</p>
</blockquote>

<p>— <a href="https://dl.acm.org/citation.cfm?id=1119749">Estimating the Support of a High-Dimensional Distribution</a>, 2001.</p>

<p>Although SVM is a classification algorithm and One-Class SVM is also a classification algorithm, it can be used to discover outliers in input data for both regression and classification datasets.</p>

<p>The scikit-learn library provides an implementation of one-class SVM in the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.OneClassSVM.html">OneClassSVM class</a>.</p>

<p>The class provides the “<em>nu</em>” argument that specifies the approximate ratio of outliers in the dataset, which defaults to 0.1. In this case, we will set it to 0.01, found with a little trial and error.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>...</p><p># identify outliers in the training dataset</p><p>ee = OneClassSVM(nu=0.01)</p><p>yhat = ee.fit_predict(X_train)</p></td></tr></tbody></table>

<p>Tying this together, the complete example of identifying and removing outliers from the housing dataset using the one class SVM method is listed below.</p>

<table><tbody><tr><td data-settings="show"><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></td><td><p># evaluate model performance with outliers removed using one class SVM</p><p>from pandas import read_csv</p><p>from sklearn.model_selection import train_test_split</p><p>from sklearn.linear_model import LinearRegression</p><p>from sklearn.svm import OneClassSVM</p><p>from sklearn.metrics import mean_absolute_error</p><p># load the dataset</p><p>url = 'https://raw.githubusercontent.com/jbrownlee/Datasets/master/housing.csv'</p><p>df = read_csv(url, header=None)</p><p># retrieve the array</p><p>data = df.values</p><p># split into input and output elements</p><p>X, y = data[:, :-1], data[:, -1]</p><p># split into train and test sets</p><p>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</p><p># summarize the shape of the training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># identify outliers in the training dataset</p><p>ee = OneClassSVM(nu=0.01)</p><p>yhat = ee.fit_predict(X_train)</p><p># select all rows that are not outliers</p><p>mask = yhat != -1</p><p>X_train, y_train = X_train[mask, :], y_train[mask]</p><p># summarize the shape of the updated training dataset</p><p>print(X_train.shape, y_train.shape)</p><p># fit the model</p><p>model = LinearRegression()</p><p>model.fit(X_train, y_train)</p><p># evaluate the model</p><p>yhat = model.predict(X_test)</p><p># evaluate predictions</p><p>mae = mean_absolute_error(y_test, yhat)</p><p>print('MAE: %.3f' % mae)</p></td></tr></tbody></table>

<p>Running the example fits and evaluates the model, then reports the MAE.</p>

<p><strong>Note</strong>: Your <a href="https://machinelearningmastery.com/different-results-each-time-in-machine-learning/">results may vary</a> given the stochastic nature of the algorithm or evaluation procedure, or differences in numerical precision. Consider running the example a few times and compare the average outcome.</p>

<p>In this case, we can see that only three outliers were identified and removed and the model achieved a MAE of about 3.431, which is not better than the baseline model that achieved 3.417. Perhaps better performance can be achieved with more tuning.</p>

<table><tbody><tr><td data-settings="show"></td><td><p>(339, 13) (339,)</p><p>(336, 13) (336,)</p><p>MAE: 3.431</p></td></tr></tbody></table>

<h2 id="further-reading">Further Reading</h2>

<p>This section provides more resources on the topic if you are looking to go deeper.</p>

<h3 id="related-tutorials">Related Tutorials</h3>

<ul>
  <li><a href="https://machinelearningmastery.com/one-class-classification-algorithms/">One-Class Classification Algorithms for Imbalanced Datasets</a></li>
  <li><a href="https://machinelearningmastery.com/how-to-use-statistics-to-identify-outliers-in-data/">How to Remove Outliers for Machine Learning</a></li>
</ul>

<h3 id="papers">Papers</h3>

<ul>
  <li><a href="https://ieeexplore.ieee.org/abstract/document/4781136">Isolation Forest</a>, 2008.</li>
  <li><a href="https://arxiv.org/abs/1709.07045">Minimum Covariance Determinant and Extensions</a>, 2017.</li>
  <li><a href="https://dl.acm.org/citation.cfm?id=335388">LOF: Identifying Density-based Local Outliers</a>, 2000.</li>
  <li><a href="https://dl.acm.org/citation.cfm?id=1119749">Estimating the Support of a High-Dimensional Distribution</a>, 2001.</li>
</ul>

<h3 id="apis">APIs</h3>

<ul>
  <li><a href="https://scikit-learn.org/stable/modules/outlier_detection.html">Novelty and Outlier Detection, scikit-learn user guide</a>.</li>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.covariance.EllipticEnvelope.html">sklearn.covariance.EllipticEnvelope API</a>.</li>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.OneClassSVM.html">sklearn.svm.OneClassSVM API</a>.</li>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.LocalOutlierFactor.html">sklearn.neighbors.LocalOutlierFactor API</a>.</li>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">sklearn.ensemble.IsolationForest API</a>.</li>
</ul>

<h2 id="summary">Summary</h2>

<p>In this tutorial, you discovered how to use automatic outlier detection and removal to improve machine learning predictive modeling performance.</p>

<p>Specifically, you learned:</p>

<ul>
  <li>Automatic outlier detection models provide an alternative to statistical techniques with a larger number of input variables with complex and unknown inter-relationships.</li>
  <li>How to correctly apply automatic outlier detection and removal to the training dataset only to avoid data leakage.</li>
  <li>How to evaluate and compare predictive modeling pipelines with outliers removed from the training dataset.</li>
</ul>

<p><strong>Do you have any questions?</strong><br />
Ask your questions in the comments below and I will do my best to answer.</p>

<h2 id="get-a-handle-on-modern-data-preparation">Get a Handle on Modern Data Preparation!</h2>

<p><a href="https://machinelearningmastery.com/data-preparation-for-machine-learning/"><img src="https://machinelearningmastery.com/wp-content/uploads/2022/11/DP4ML-220.png" alt="" /></a></p>

<h4 id="prepare-your-machine-learning-data-in-minutes">Prepare Your Machine Learning Data in Minutes</h4>

<p>…with just a few lines of python code</p>

<p>Discover how in my new Ebook:<br />
<a href="https://machinelearningmastery.com/data-preparation-for-machine-learning/">Data Preparation for Machine Learning</a></p>

<p>It provides <strong>self-study tutorials</strong> with <strong>full working code</strong> on:<br />
<em>Feature Selection</em>, <em>RFE</em>, <em>Data Cleaning</em>, <em>Data Transforms</em>, <em>Scaling</em>, <em>Dimensionality Reduction</em>, and much more…</p>

<h4 id="bring-modern-data-preparation-techniques-to">Bring Modern Data Preparation Techniques to</h4>
<p>Your Machine Learning Projects</p>

<p><a href="https://machinelearningmastery.com/data-preparation-for-machine-learning/">See What’s Inside</a></p>
                    
                </section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
    </div>
</div>

                        <a href="/Materials-Research-Notes/Chap2-ML/GBR/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: ML - Gradient Boosting Algorithm">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/Materials-Research-Notes/Chap2-ML/Pytorch_tricks/" class="navigation navigation-next navigation-unique" aria-label="Next page: Pytorch tricks">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Pytorch tricks",
            "level": "1.2",
            "depth": 1,
            "path": "_Chap2-ML/Pytorch_tricks.markdown",
            "ref": "_Chap2-ML/Pytorch_tricks.markdown",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Lei's Notes",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_Chap2-ML/Out_liers.markdown",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "",
        "time": "2023-10-03 09:33:30 +0100"
    },
    "basePath": "/Materials-Research-Notes",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/Materials-Research-Notes/gitbook/gitbook.js"></script>
<script src="/Materials-Research-Notes/gitbook/theme.js"></script>

<script src="/Materials-Research-Notes/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/Materials-Research-Notes/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/Materials-Research-Notes/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/Materials-Research-Notes/gitbook/gitbook-plugin-search-pro/search.js"></script>

<script src="/Materials-Research-Notes/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</body>
</html>